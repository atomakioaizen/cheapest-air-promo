<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cheapest Air | Flight Promos</title>
    <link rel="stylesheet" href="style.css">
    <style>
        .ticket-card {
            position: relative;
        }

        .btn-delete-card {
            border-radius: 50%;
            width: 30px;
            height: 30px;
            font-size: 16px;
            cursor: pointer;
            display: none;
            /* Hidden for customers */
            align-items: center;
            justify-content: center;
            z-index: 10;
        }

        .btn-delete-card:hover {
            background: #c62828;
            color: white;
        }

        /* ... */
    </style>

    <!-- ... (In JS) ... -->
    <script>
        // ... (Data & Init preserved) ...

        function showDeleteButtons(show) {
            document.querySelectorAll('.btn-delete-card').forEach(btn => {
                btn.style.display = show ? 'flex' : 'none';
            });
        }

        function attemptLogin() {
            const user = document.getElementById('loginUser');
            const pass = document.getElementById('loginPass');

            if (user.value === "admin" && pass.value === "admin123") {
                // CLEAR CREDENTIALS
                user.value = "";
                pass.value = "";

                closeLogin();
                // Switch View
                document.getElementById('customerView').style.display = 'none';
                document.getElementById('adminView').style.display = 'block';

                // FORCE POPULATE ON LOGIN
                initAdminForm();

                // Show Delete Buttons for existing cards (if any have the class)
                showDeleteButtons(true);

            } else {
                alert("Incorrect username or password");
            }
        }

        function logoutAdmin() {
            document.getElementById('adminView').style.display = 'none';
            document.getElementById('customerView').style.display = 'block';

            // Hide Delete Buttons
            showDeleteButtons(false);

            // Clear Status
            const stat = document.getElementById('statusMsg');
            stat.style.display = 'none';
            stat.innerText = '';
        }

        // --- FORM RESETTER ---
        function resetForm() {
            // Text/Values
            document.getElementById('newPrice').value = "";
            document.getElementById('dateStart').value = "";
            document.getElementById('dateEnd').value = "";
            document.getElementById('isPiso').checked = false;

            // Dropdowns (Set to first option or specific defaults)
            const origin = document.getElementById('newOrigin');
            if (origin.options.length > 0) origin.selectedIndex = 0; // Default MNL usually

            const dest = document.getElementById('newDest');
            if (dest.options.length > 1) dest.selectedIndex = 1; // Default NRT usually

            document.getElementById('newAirline').selectedIndex = 0;
            document.getElementById('newCabin').selectedIndex = 0;

            // Radios
            document.querySelector('input[name="tripType"][value="roundtrip"]').checked = true;
            document.querySelector('input[name="baseCat"][value="international"]').checked = true;

            // Trigger UI Updates
            toggleTripType();
        }


        // --- DELETE PROMO LOGIC ---
        async function deletePromo(id, btnElement) {
            const confirmDelete = confirm("Are you sure you want to DELETE this promo forever?");
            if (!confirmDelete) return;

            const token = document.getElementById('githubToken').value;
            const username = document.getElementById('ghUsername').value;
            const repo = document.getElementById('ghRepo').value;

            if (!token) {
                alert("Please login as Admin to delete.");
                return;
            }

            // feedback
            const originalText = btnElement.innerText;
            btnElement.innerText = "‚è≥";
            btnElement.disabled = true;

            try {
                const REPO_FULL = `${username}/${repo}`;
                const PATH = "index.html";
                const API_URL = `https://api.github.com/repos/${REPO_FULL}/contents/${PATH}`;

                const getRes = await fetch(API_URL, { headers: { 'Authorization': `token ${token}` } });
                if (!getRes.ok) throw new Error("Fetch failed");

                const data = await getRes.json();
                const currentContent = new TextDecoder().decode(Uint8Array.from(atob(data.content), c => c.charCodeAt(0)));

                // Regex to find the promo block by ID
                // Pattern: Look for the article tag with the specific ID and remove it.
                // Safe approach: <article[^>]*id="promo-123"[^>]*>[\s\S]*?<\/article>
                const regex = new RegExp(`<article[^>]*id="${id}"[^>]*>[\\s\\S]*?<\\/article>`, 'g');

                if (!regex.test(currentContent)) {
                    throw new Error("Promo not found in file (might be an old promo without ID).");
                }

                const newContent = currentContent.replace(regex, ''); // Remove it

                // Push Update
                const putRes = await fetch(API_URL, {
                    method: "PUT",
                    headers: { 'Authorization': `token ${token}` },
                    body: JSON.stringify({
                        message: `Delete Promo ID: ${id}`,
                        content: btoa(String.fromCharCode(...new TextEncoder().encode(newContent))),
                        sha: data.sha
                    })
                });

                if (!putRes.ok) throw new Error("Failed to delete on GitHub.");

                // Success: Remove from DOM
                const card = document.getElementById(id);
                if (card) card.remove();

                alert("Promo Deleted Successfully!");

            } catch (err) {
                console.error(err);
                alert("Delete Failed: " + err.message);
                btnElement.innerText = "üóëÔ∏è";
                btnElement.disabled = false;
            }
        }


        async function addNewPromo() {
            // ... (Token checks same) ...
            const token = document.getElementById('githubToken').value;
            const username = document.getElementById('ghUsername').value;
            const repo = document.getElementById('ghRepo').value;
            const statusBox = document.getElementById('statusMsg');

            if (!token || !username || !repo) { alert("‚ö†Ô∏è Missing Settings!"); return; }

            // Save Settings
            if (document.getElementById('saveToken').checked) {
                localStorage.setItem('gh_token', token);
                localStorage.setItem('gh_username', username);
                localStorage.setItem('gh_repo', repo);
            }

            // Get Values
            const originVal = document.getElementById('newOrigin').value.split('|');
            const destVal = document.getElementById('newDest').value.split('|');
            const airline = document.getElementById('newAirline').value;
            let price = document.getElementById('newPrice').value.trim();
            const cabin = document.getElementById('newCabin').value;

            // Auto-Peso & Format
            // Remove existing non-numeric chars except comma/dot? No, simpler.
            // If it looks like a number "5000", make it "‚Ç±5,000"
            const rawNum = price.replace(/[^0-9.]/g, '');
            if (rawNum && !price.includes('‚Ç±')) {
                const num = parseFloat(rawNum);
                price = "‚Ç±" + num.toLocaleString('en-US');
            } else if (!price.includes('‚Ç±') && hasNumber(price)) {
                price = "‚Ç±" + price;
            }

            function hasNumber(myString) { return /\d/.test(myString); }


            // Categories
            const baseCat = document.querySelector('input[name="baseCat"]:checked').value;
            const isPiso = document.getElementById('isPiso').checked;
            let finalCat = baseCat;
            if (isPiso) finalCat += " piso";

            // Date
            const dStart = document.getElementById('dateStart').value;
            const dEnd = document.getElementById('dateEnd').value;
            const tripType = document.querySelector('input[name="tripType"]:checked').value;
            const isOneWay = tripType === 'oneway';

            if (!dStart) { alert("Please select a travel date."); return; }
            if (tripType === 'roundtrip' && !dEnd) { alert("Please select a return date."); return; }

            const dateStr = formatDateRange(dStart, dEnd, isOneWay);

            // ID Generation
            const promoID = "promo-" + Date.now();

            // Construct HTML
            const pisoTag = isPiso ? '<span class="tag-piso">üî• PISO FARE WATCH</span>' : '';
            const tripLabel = tripType === 'multicity' ? '<span style="font-size:0.7em; background:#333; padding:2px 4px; border-radius:3px;">Multi-city</span>' : '';

            // Added styling: display:flex or block for admin button. defaults to hidden via CSS class but we add inline style if currently admin?
            // Actually, since we are adding it FROM admin view, we can just make it visible initially? 
            // No, because this HTML goes to the public site. It MUST be display:none default (via css class) and shown only by JS on load if admin.

            const newCardHTML = `
            <!-- ADDDED PROMO: ${originVal[1]} to ${destVal[1]} -->
            <article class="ticket-card" id="${promoID}" data-category="${finalCat}">
                <button class="btn-delete-card" onclick="deletePromo('${promoID}', this)" title="Delete Promo">üóëÔ∏è</button>
                <div class="flight-route">
                    <div class="location"><span class="code">${originVal[0]}</span><span class="city">${originVal[1]}</span></div>
                    <div class="plane-icon">‚úàÔ∏è ${tripLabel}</div>
                    <div class="location"><span class="code">${destVal[0]}</span><span class="city">${destVal[1]}</span></div>
                </div>
                <div class="flight-details">
                    ${pisoTag}
                    <p class="travel-date">üìÖ ${dateStr}</p>
                    <p class="airline">Airline: ${airline} (${cabin})</p>
                    <div class="pricing">
                        <div class="price-label">Promo Fare</div>
                        <div class="price-val">${price}</div>
                    </div>
                </div>
                <button onclick="openBooking('${originVal[1]} to ${destVal[1]}', '${price}')" class="btn-claim">Book This Flight</button>
            </article>`;

            // UI Feedback
            const btn = document.querySelector('.admin-form .btn-claim');
            const originalText = btn.innerText;
            btn.innerText = "‚è≥ Saving...";
            btn.disabled = true;
            statusBox.style.display = 'block';
            statusBox.style.background = '#e0f2fe';
            statusBox.style.color = '#0284c7';
            statusBox.innerText = "Syncing with GitHub...";

            try {
                // ... (Fetch logic preserved) ...
                const REPO_FULL = `${username}/${repo}`;
                const PATH = "index.html";
                const API_URL = `https://api.github.com/repos/${REPO_FULL}/contents/${PATH}`;

                const getRes = await fetch(API_URL, { headers: { 'Authorization': `token ${token}` } });
                if (!getRes.ok) throw new Error("GitHub Error: " + getRes.status);

                const data = await getRes.json();
                const currentContent = new TextDecoder().decode(Uint8Array.from(atob(data.content), c => c.charCodeAt(0)));
                const insertionPoint = '<div class="promo-grid" id="mainPromoGrid">

            <!-- ADDDED PROMO: Manila (NAIA) to Tokyo (Narita) -->
            <article class="ticket-card" id="promo-1767343812643" data-category="international piso">
                <button class="btn-delete-card" onclick="deletePromo('promo-1767343812643', this)" title="Delete Promo">üóëÔ∏è</button>
                <div class="flight-route">
                    <div class="location"><span class="code">MNL</span><span class="city">Manila (NAIA)</span></div>
                    <div class="plane-icon">‚úàÔ∏è </div>
                    <div class="location"><span class="code">NRT</span><span class="city">Tokyo (Narita)</span></div>
                </div>
                <div class="flight-details">
                    <span class="tag-piso">üî• PISO FARE WATCH</span>
                    <p class="travel-date">üìÖ Dec 31 - Jan 2, 2026</p>
                    <p class="airline">Airline: Cebu Pacific (Economy)</p>
                    <div class="pricing">
                        <div class="price-label">Promo Fare</div>
                        <div class="price-val">‚Ç±1</div>
                    </div>
                </div>
                <button onclick="openBooking('Manila (NAIA) to Tokyo (Narita)', '‚Ç±1')" class="btn-claim">Book This Flight</button>
            </article>';

                const newContent = currentContent.replace(insertionPoint, insertionPoint + "\n" + newCardHTML);

                const putRes = await fetch(API_URL, {
                    method: "PUT",
                    headers: { 'Authorization': `token ${token}` },
                    body: JSON.stringify({
                        message: `Add Promo: ${originVal[1]} to ${destVal[1]}`,
                        content: btoa(String.fromCharCode(...new TextEncoder().encode(newContent))),
                        sha: data.sha
                    })
                });

                if (!putRes.ok) throw new Error("Failed to commit.");

                // Success
                btn.innerText = originalText;
                btn.disabled = false;
                statusBox.style.background = '#dcfce7';
                statusBox.style.color = '#166534';
                statusBox.innerHTML = `‚úÖ <b>Promo Added!</b><br>${originVal[1]} ‚ûù ${destVal[1]}`;

                // Add to grid
                const grid = document.getElementById('mainPromoGrid');
                const tempDiv = document.createElement('div');
                tempDiv.innerHTML = newCardHTML;
                const newNode = tempDiv.firstElementChild;
                grid.insertBefore(newNode, grid.firstChild);

                // Show delete button immediately since we are admin
                newNode.querySelector('.btn-delete-card').style.display = 'flex';

                // RESET FORM
                resetForm();

                // Fade Msg
                setTimeout(() => { statusBox.style.display = 'none'; }, 5000);

            } catch (err) {
                console.error(err);
                btn.innerText = originalText;
                btn.disabled = false;
                statusBox.style.background = '#fee2e2';
                statusBox.innerText = "Error: " + err.message;
            }
        }
    </script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;500;700;900&family=Plus+Jakarta+Sans:wght@400;500;600&display=swap"
        rel="stylesheet">
</head>

<body>

    <!-- Login Modal -->
    <div id="loginModal" class="modal-overlay">
        <div class="modal-content" style="max-width: 400px;">
            <span class="close-modal" onclick="closeLogin()">&times;</span>
            <div class="modal-header">
                <h3>Admin Login</h3>
                <p>Enter your credentials to manage promos.</p>
            </div>
            <div class="booking-form">
                <div class="form-group">
                    <label>Username</label>
                    <input type="text" id="loginUser" placeholder="admin">
                </div>
                <div class="form-group">
                    <label>Password</label>
                    <input type="password" id="loginPass" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢">
                </div>
                <button onclick="attemptLogin()" class="btn-claim" style="margin-top: 10px;">Log In</button>
            </div>
        </div>
    </div>

    <!-- Header / Navbar -->
    <header class="navbar">
        <div class="container">
            <div class="logo">‚úàÔ∏è Cheapest<span>Air</span></div>
            <nav>
                <a href="#" class="active">Flight Promos</a>
                <a href="#">About Us</a>
                <a href="#" onclick="showLogin()">Log In</a>
            </nav>
        </div>
    </header>

    <!-- CUSTOMER VIEW WRAPPER -->
    <div id="customerView">
        <!-- Hero Section -->
        <section class="hero">
            <div class="hero-content">
                <h1>Fly For Less. Standard Class.</h1>
                <p>Exclusive airline promo seats released daily.</p>
            </div>
        </section>

        <!-- Filter / Status Bar -->
        <div class="filter-bar container">
            <button class="filter-btn active" onclick="filterDeals('all')">Show All</button>
            <button class="filter-btn" onclick="filterDeals('piso')">üî• Piso Fare</button>
            <button class="filter-btn" onclick="filterDeals('international')">üåè International</button>
            <button class="filter-btn" onclick="filterDeals('domestic')">üèùÔ∏è Domestic</button>
        </div>

        <!-- Main Content: Promo Grid -->
        <main class="container">
            <h2 class="section-title">Latest Flight Deals</h2>

            <div class="promo-grid" id="mainPromoGrid">

                <!-- Flight Card: Example 1 -->
                <article class="ticket-card" id="demo-1" data-category="international">
                    <button class="btn-delete-card" onclick="deletePromo('demo-1', this)"
                        title="Delete Promo">üóëÔ∏è</button>
                    <div class="flight-route">
                        <div class="location">
                            <span class="code">MNL</span>
                            <span class="city">Manila</span>
                        </div>
                        <div class="plane-icon">‚úàÔ∏è</div>
                        <div class="location">
                            <span class="code">NRT</span>
                            <span class="city">Tokyo</span>
                        </div>
                    </div>
                    <div class="flight-details">
                        <p class="travel-date">üìÖ Travel Period: Oct - Dec 2026</p>
                        <p class="airline">Airline: Cebu Pac / PAL</p>
                        <div class="pricing">
                            <div class="price-label">Roundtrip All-in</div>
                            <div class="price-val">‚Ç±8,999</div>
                        </div>
                    </div>
                    <button onclick="openBooking('Manila to Tokyo', '‚Ç±8,999')" class="btn-claim">
                        Book This Flight
                    </button>
                </article>

                <!-- Flight Card: Example 2 -->
                <article class="ticket-card" id="demo-2" data-category="piso international">
                    <button class="btn-delete-card" onclick="deletePromo('demo-2', this)"
                        title="Delete Promo">üóëÔ∏è</button>
                    <div class="flight-route">
                        <div class="location">
                            <span class="code">MNL</span>
                            <span class="city">Manila</span>
                        </div>
                        <div class="plane-icon">‚úàÔ∏è</div>
                        <div class="location">
                            <span class="code">KIX</span>
                            <span class="city">Osaka</span>
                        </div>
                    </div>
                    <div class="flight-details">
                        <span class="tag-piso">üî• PISO FARE WATCH</span>
                        <p class="travel-date">üìÖ Travel Period: Sep 2026</p>
                        <p class="airline">Airline: Jetstar</p>
                        <div class="pricing">
                            <div class="price-label">One-way Base Fare</div>
                            <div class="price-val">‚Ç±2,500</div>
                        </div>
                    </div>
                    <button onclick="openBooking('Manila to Osaka', '‚Ç±2,500/base')" class="btn-claim">
                        Book This Flight
                    </button>
                </article>

            </div>
        </main>
    </div> <!-- End Customer View -->


    <!-- ADMIN VIEW (Direct Promo Adder & Auto-Save) -->
    <div id="adminView" class="container" style="display: none; padding-top: 40px;">
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
            <h1 style="font-size: 2rem;">üëë Admin Dashboard</h1>
            <button onclick="logoutAdmin()" class="filter-btn" style="border-color: #ef4444; color: #ef4444;">Log
                Out</button>
        </div>

        <div class="admin-panel">
            <h3>Add New Promo</h3>
            <div class="booking-form admin-form">

                <!-- AIRPAZ-STYLE SEARCH WIDGET -->
                <div style="margin-bottom: 20px;">

                    <!-- Top Row: Trip Type -->
                    <div style="display: flex; gap: 20px; margin-bottom: 15px; color: #cbd5e1; font-size: 0.9rem;">
                        <label style="cursor: pointer; display: flex; align-items: center; gap: 6px;">
                            <input type="radio" name="tripType" value="roundtrip" checked onchange="toggleTripType()"
                                style="accent-color: var(--brand-orange);">
                            Round Trip
                        </label>
                        <label style="cursor: pointer; display: flex; align-items: center; gap: 6px;">
                            <input type="radio" name="tripType" value="oneway" onchange="toggleTripType()"
                                style="accent-color: var(--brand-orange);">
                            One Way
                        </label>
                        <label style="cursor: pointer; display: flex; align-items: center; gap: 6px;">
                            <input type="radio" name="tripType" value="multicity" onchange="toggleTripType()"
                                style="accent-color: var(--brand-orange);">
                            Multi-city
                        </label>
                    </div>

                    <!-- Main Grid Inputs -->
                    <div
                        style="display: grid; grid-template-columns: 1.5fr 1.5fr 1fr 1fr; gap: 10px; margin-bottom: 10px;">

                        <!-- Origin -->
                        <div class="form-group tight">
                            <label style="font-size: 0.75rem; color: #94a3b8; margin-bottom: 4px;">From</label>
                            <div style="position: relative;">
                                <span
                                    style="position: absolute; left: 10px; top: 50%; transform: translateY(-50%);">üõ´</span>
                                <select id="newOrigin" class="admin-select"
                                    style="padding-left: 35px; font-weight: 600;">
                                    <!-- Populated by JS -->
                                </select>
                            </div>
                        </div>

                        <!-- Destination -->
                        <div class="form-group tight">
                            <label style="font-size: 0.75rem; color: #94a3b8; margin-bottom: 4px;">To</label>
                            <div style="position: relative;">
                                <span
                                    style="position: absolute; left: 10px; top: 50%; transform: translateY(-50%);">üõ¨</span>
                                <select id="newDest" class="admin-select" style="padding-left: 35px; font-weight: 600;">
                                    <!-- Populated by JS -->
                                </select>
                            </div>
                        </div>

                        <!-- Departure -->
                        <div class="form-group tight">
                            <label style="font-size: 0.75rem; color: #94a3b8; margin-bottom: 4px;">Departure</label>
                            <input type="date" id="dateStart" class="admin-input" style="font-size: 0.85rem;">
                        </div>

                        <!-- Return -->
                        <div class="form-group tight">
                            <label id="lblReturn"
                                style="font-size: 0.75rem; color: #94a3b8; margin-bottom: 4px;">Return</label>
                            <input type="date" id="dateEnd" class="admin-input" style="font-size: 0.85rem;">
                            <!-- Hidden checkbox sync -->
                            <input type="checkbox" id="isOneWay" style="display:none;">
                        </div>
                    </div>

                    <!-- Secondary Row: Cabin, Airline, Price -->
                    <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 10px;">

                        <!-- Cabin Class -->
                        <div class="form-group tight">
                            <label style="font-size: 0.75rem; color: #94a3b8; margin-bottom: 4px;">Cabin Class</label>
                            <select id="newCabin" class="admin-select" style="font-size: 0.9rem;">
                                <option value="Economy" selected>Economy</option>
                                <option value="Premium Economy">Premium Economy</option>
                                <option value="Business">Business</option>
                                <option value="First Class">First Class</option>
                            </select>
                        </div>

                        <!-- Airline -->
                        <div class="form-group tight">
                            <label style="font-size: 0.75rem; color: #94a3b8; margin-bottom: 4px;">Airline</label>
                            <select id="newAirline" class="admin-select" style="font-size: 0.9rem;">
                                <!-- Populated JS -->
                            </select>
                        </div>

                        <!-- Price -->
                        <div class="form-group tight">
                            <label style="font-size: 0.75rem; color: #94a3b8; margin-bottom: 4px;">Promo Price</label>
                            <input type="text" id="newPrice" placeholder="‚Ç±..."
                                style="font-weight: bold; color: var(--brand-orange);">
                        </div>
                    </div>

                    <!-- Promo Category Tags -->
                    <div
                        style="margin-top: 15px; display: flex; align-items: center; gap: 15px; border-top: 1px dashed rgba(255,255,255,0.1); padding-top: 15px;">
                        <span style="font-size: 0.8rem; color: #cbd5e1;">Route Type:</span>
                        <label style="font-size: 0.85rem;"><input type="radio" name="baseCat" value="international"
                                checked> üåè International</label>
                        <label style="font-size: 0.85rem;"><input type="radio" name="baseCat" value="domestic"> üáµüá≠
                            Domestic</label>

                        <div style="width: 1px; height: 20px; background: rgba(255,255,255,0.2); margin: 0 10px;">
                        </div>

                        <label style="font-size: 0.85rem; font-weight: bold; color: #fbbf24;">
                            <input type="checkbox" id="isPiso"> üî• Piso Fare
                        </label>
                    </div>

                </div>

                <!-- GitHub Token for Save -->
                <div
                    style="background: rgba(255,100,0,0.1); padding: 15px; border-radius: 8px; margin-bottom: 20px; border: 1px dashed orange;">
                    <label style="color: orange; font-size: 0.9rem; font-weight: bold;">‚öôÔ∏è GITHUB SETUP
                        (Required)</label>
                    <p style="font-size: 0.8rem; color: #ccc; margin-bottom: 8px;">Verify these settings to connect to
                        YOUR repository.</p>

                    <div style="display: flex; gap: 10px; margin-bottom: 10px;">
                        <input type="text" id="ghUsername" value="atomakioaizen" placeholder="GitHub Username"
                            style="font-size: 0.9rem; flex: 1;">
                        <input type="text" id="ghRepo" value="cheapest-air-promo" placeholder="Repo Name"
                            style="font-size: 0.9rem; flex: 1;">
                    </div>

                    <label style="color: orange; font-size: 0.8rem; font-weight: bold;">üîë SECRET KEY</label>
                    <input type="password" id="githubToken" placeholder="ghp_xxxxxxxxxxxx..."
                        style="font-size: 0.9rem; margin-bottom: 5px;">

                    <div style="margin-top: 5px;">
                        <label style="font-size: 0.8rem; color: #fff; cursor: pointer;">
                            <input type="checkbox" id="saveToken"> Remember my settings (Save in browser)
                        </label>
                    </div>
                </div>

                <!-- Status Message Area -->
                <div id="statusMsg"
                    style="display: none; padding: 10px; margin-bottom: 10px; border-radius: 5px; text-align: center; font-size: 0.9rem;">
                </div>

                <button onclick="addNewPromo()" class="btn-claim"
                    style="background: var(--brand-orange); width: 100%; font-size: 1.1rem;">
                    + Search & Publish Promo
                </button>
            </div>
        </div>
    </div>


    <footer>
        <p>&copy; 2026 Cheapest Air. Unbeatable Prices.</p>
    </footer>

    <!-- Booking Modal -->
    <div id="bookingModal" class="modal-overlay">
        <div class="modal-content">
            <span class="close-modal" onclick="closeModal()">&times;</span>
            <div class="modal-header">
                <h3>Flight Inquiry</h3>
                <p style="font-size: 0.9rem; color: #94a3b8;">You are selecting:</p>
            </div>

            <div class="modal-flight-info compact-info">
                <span id="modalRoute" style="color: #8b5cf6; font-weight: bold;">MNL ‚ûù NRT</span>
                <span style="margin: 0 10px;">|</span>
                <span id="modalPrice" style="color: white; font-weight: 700;">‚Ç±8,999</span>
            </div>

            <div class="modal-steps compact-steps">
                <p>1. Send us your inquiry.</p>
                <p>2. We verify availability.</p>
                <p>3. Pay via GCash/Bank.</p>
            </div>

            <!-- Booking Form -->
            <form action="https://formsubmit.co/YOUR_EMAIL_HERE" method="POST" class="booking-form compact-form">
                <!-- Hidden fields -->
                <input type="hidden" name="_subject" value="New Flight Promo Inquiry!">
                <input type="hidden" name="_captcha" value="false">
                <input type="hidden" id="inputRoute" name="Flight Route">
                <input type="hidden" id="inputPrice" name="Price">

                <div class="form-group tight">
                    <label>Full Name</label>
                    <input type="text" name="name" required placeholder="Name">
                </div>

                <div class="form-group tight">
                    <label>Facebook Link</label>
                    <input type="url" name="facebook" required placeholder="fb.com/profile">
                </div>

                <div class="form-group tight">
                    <label>Mobile No.</label>
                    <input type="tel" name="mobile" required placeholder="0917...">
                </div>

                <button type="submit" class="btn-claim" style="margin-top: 15px;">
                    Submit Inquiry
                </button>
            </form>

        </div>
    </div>

    <script>
        // --- DATA: Airports & Airlines Database ---
        const airports = {
            domestic: [
                { code: "MNL", city: "Manila (NAIA)" },
                { code: "CEB", city: "Cebu (Mactan)" },
                { code: "DVO", city: "Davao" },
                { code: "CRK", city: "Clark" },
                { code: "MPH", city: "Caticlan (Boracay)" },
                { code: "KLO", city: "Kalibo" },
                { code: "PPS", city: "Puerto Princesa" },
                { code: "USU", city: "Coron (Busuanga)" },
                { code: "IAO", city: "Siargao" },
                { code: "TAG", city: "Bohol (Panglao)" },
                { code: "BCD", city: "Bacolod" },
                { code: "ILO", city: "Iloilo" },
                { code: "TAC", city: "Tacloban" },
                { code: "ZAM", city: "Zamboanga" },
                { code: "GES", city: "General Santos" },
                { code: "LAO", city: "Laoag" }
            ],
            international: [
                { code: "NRT", city: "Tokyo (Narita)" },
                { code: "HND", city: "Tokyo (Haneda)" },
                { code: "KIX", city: "Osaka (Kansai)" },
                { code: "FUK", city: "Fukuoka" },
                { code: "CTS", city: "Sapporo" },
                { code: "ICN", city: "Seoul (Incheon)" },
                { code: "PUS", city: "Busan" },
                { code: "SIN", city: "Singapore" },
                { code: "BKK", city: "Bangkok (Suvarnabhumi)" },
                { code: "DMK", city: "Bangkok (Don Mueang)" },
                { code: "HKG", city: "Hong Kong" },
                { code: "TPE", city: "Taipei" },
                { code: "KUL", city: "Kuala Lumpur" },
                { code: "SGN", city: "Ho Chi Minh City" },
                { code: "DPS", city: "Bali (Denpasar)" },
                { code: "DXB", city: "Dubai" },
                { code: "DOH", city: "Doha" },
                { code: "SYD", city: "Sydney" },
                { code: "MEL", city: "Melbourne" },
                { code: "LAX", city: "Los Angeles" },
                { code: "SFO", city: "San Francisco" },
                { code: "JFK", city: "New York" },
                { code: "LHR", city: "London (Heathrow)" }
            ]
        };

        const airlines = [
            "Cebu Pacific", "Philippine Airlines (PAL)", "AirAsia", "PAL Express",
            "Cebgo", "Jetstar", "Scoot", "Singapore Airlines", "Cathay Pacific",
            "EVA Air", "Korean Air", "Asiana Airlines", "Japan Airlines (JAL)",
            "ANA", "Emirates", "Qatar Airways", "Etihad", "Qantas", "United Airlines"
        ];

        // --- INIT: Admin Form Logic ---
        function initAdminForm() {
            // Populate Airlines
            const airlineSelect = document.getElementById('newAirline');
            airlineSelect.innerHTML = airlines.map(a => `<option value="${a}">${a}</option>`).join('');

            // Setup Category Listeners (Optional if we show all, but keeping for data-cat)
            // Functionality simplified: Just init.
            populateAirports();
        }

        // --- IMPROVED POPULATE: Show All like Real Ticketing ---
        function populateAirports() {
            const originSelect = document.getElementById('newOrigin');
            const destSelect = document.getElementById('newDest');

            // Debugging: Ensure arrays exist
            if (!airports.domestic || !airports.international) {
                console.error("Airport data missing!");
                return;
            }

            // Build Options Explicitly
            let domOpts = '<optgroup label="üáµüá≠ Domestic">';
            airports.domestic.forEach(a => {
                domOpts += `<option value="${a.code}|${a.city}">${a.city} (${a.code})</option>`;
            });
            domOpts += '</optgroup>';

            let intlOpts = '<optgroup label="üåè International">';
            airports.international.forEach(a => {
                intlOpts += `<option value="${a.code}|${a.city}">${a.city} (${a.code})</option>`;
            });
            intlOpts += '</optgroup>';

            const fullList = domOpts + intlOpts;

            // Force Update
            originSelect.innerHTML = fullList;
            destSelect.innerHTML = fullList;

            // Set Defaults (MNL -> NRT)
            // We use a small timeout to ensure DOM render in some browsers, though direct set is usually fine.
            originSelect.value = "MNL|Manila (NAIA)";
            destSelect.value = "NRT|Tokyo (Narita)";
        }


        // --- VIEW NAVIGATION ---
        function showLogin() {
            document.getElementById('loginModal').classList.add('show');
            // Check for saved data
            const savedToken = localStorage.getItem('gh_token');
            const savedUser = localStorage.getItem('gh_username');
            const savedRepo = localStorage.getItem('gh_repo');

            if (savedToken) {
                document.getElementById('githubToken').value = savedToken;
                if (savedUser) document.getElementById('ghUsername').value = savedUser;
                if (savedRepo) document.getElementById('ghRepo').value = savedRepo;
                document.getElementById('saveToken').checked = true;
            }
        }

        function closeLogin() {
            document.getElementById('loginModal').classList.remove('show');
        }

        function showDeleteButtons(show) {
            document.querySelectorAll('.btn-delete-card').forEach(btn => {
                btn.style.display = show ? 'flex' : 'none';
            });
        }

        function attemptLogin() {
            const user = document.getElementById('loginUser');
            const pass = document.getElementById('loginPass');

            if (user.value === "admin" && pass.value === "admin123") {
                // CLEAR CREDENTIALS
                user.value = "";
                pass.value = "";

                closeLogin();
                // Switch View
                document.getElementById('customerView').style.display = 'none';
                document.getElementById('adminView').style.display = 'block';

                // FORCE POPULATE ON LOGIN
                initAdminForm();

                // Show Delete Buttons for existing cards
                showDeleteButtons(true);

            } else {
                alert("Incorrect username or password");
            }
        }

        function logoutAdmin() {
            document.getElementById('adminView').style.display = 'none';
            document.getElementById('customerView').style.display = 'block';

            // Hide Delete Buttons
            showDeleteButtons(false);

            // Clear Status
            const stat = document.getElementById('statusMsg');
            stat.style.display = 'none';
            stat.innerText = '';
        }

        // --- FORM RESETTER ---
        function resetForm() {
            // Text/Values
            document.getElementById('newPrice').value = "";
            document.getElementById('dateStart').value = "";
            document.getElementById('dateEnd').value = "";
            document.getElementById('isPiso').checked = false;

            // Dropdowns (Set to first option or specific defaults)
            const origin = document.getElementById('newOrigin');
            if (origin.options.length > 0) origin.selectedIndex = 0;

            const dest = document.getElementById('newDest');
            if (dest.options.length > 1) dest.selectedIndex = 1;

            document.getElementById('newAirline').selectedIndex = 0;
            document.getElementById('newCabin').selectedIndex = 0;

            // Radios
            document.querySelector('input[name="tripType"][value="roundtrip"]').checked = true;
            document.querySelector('input[name="baseCat"][value="international"]').checked = true;

            // Trigger UI Updates
            toggleTripType();
        }

        // --- DELETE PROMO LOGIC ---
        async function deletePromo(id, btnElement) {
            const confirmDelete = confirm("Are you sure you want to DELETE this promo forever?");
            if (!confirmDelete) return;

            const token = document.getElementById('githubToken').value;
            const username = document.getElementById('ghUsername').value;
            const repo = document.getElementById('ghRepo').value;

            if (!token) {
                alert("Please login as Admin to delete.");
                return;
            }

            // feedback
            const originalText = btnElement.innerText;
            btnElement.innerText = "‚è≥";
            btnElement.disabled = true;

            try {
                const REPO_FULL = `${username}/${repo}`;
                const PATH = "index.html";
                const API_URL = `https://api.github.com/repos/${REPO_FULL}/contents/${PATH}`;

                const getRes = await fetch(API_URL, { headers: { 'Authorization': `token ${token}` } });
                if (!getRes.ok) throw new Error("Fetch failed");

                const data = await getRes.json();
                const currentContent = new TextDecoder().decode(Uint8Array.from(atob(data.content), c => c.charCodeAt(0)));

                // Regex to find the promo block by ID
                const regex = new RegExp(`<article[^>]*id="${id}"[^>]*>[\\s\\S]*?<\\/article>`, 'g');

                if (!regex.test(currentContent)) {
                    throw new Error("Promo not found in file (might be an old promo without ID).");
                }

                const newContent = currentContent.replace(regex, ''); // Remove it

                // Push Update
                const putRes = await fetch(API_URL, {
                    method: "PUT",
                    headers: { 'Authorization': `token ${token}` },
                    body: JSON.stringify({
                        message: `Delete Promo ID: ${id}`,
                        content: btoa(String.fromCharCode(...new TextEncoder().encode(newContent))),
                        sha: data.sha
                    })
                });

                if (!putRes.ok) throw new Error("Failed to delete on GitHub.");

                // Success: Remove from DOM
                const card = document.getElementById(id);
                if (card) card.remove();

                alert("Promo Deleted Successfully!");

            } catch (err) {
                console.error(err);
                alert("Delete Failed: " + err.message);
                btnElement.innerText = "üóëÔ∏è";
                btnElement.disabled = false;
            }
        }


        // --- GITHUB API AUTO-SAVE LOGIC (NO RELOAD) ---
        async function addNewPromo() {
            const token = document.getElementById('githubToken').value;
            const username = document.getElementById('ghUsername').value;
            const repo = document.getElementById('ghRepo').value;
            const statusBox = document.getElementById('statusMsg');

            if (!token || !username || !repo) {
                alert("‚ö†Ô∏è Missing Settings!\n\nPlease enter your GitHub Username, Repo Name, and Secret Key.");
                return;
            }

            // Save Settings Preference
            if (document.getElementById('saveToken').checked) {
                localStorage.setItem('gh_token', token);
                localStorage.setItem('gh_username', username);
                localStorage.setItem('gh_repo', repo);
            } else {
                localStorage.removeItem('gh_token');
                localStorage.removeItem('gh_username');
                localStorage.removeItem('gh_repo');
            }

            // Get Form Values
            const originVal = document.getElementById('newOrigin').value.split('|');
            const destVal = document.getElementById('newDest').value.split('|');
            const airline = document.getElementById('newAirline').value;
            let price = document.getElementById('newPrice').value.trim();
            const cabin = document.getElementById('newCabin').value;

            // Auto-Peso & Format Logic
            const rawNum = price.replace(/[^0-9.]/g, '');
            if (rawNum && !price.includes('‚Ç±')) {
                const num = parseFloat(rawNum);
                price = "‚Ç±" + num.toLocaleString('en-US');
            } else if (!price.includes('‚Ç±') && /\d/.test(price)) {
                price = "‚Ç±" + price;
            }

            // Category Logic
            const baseCat = document.querySelector('input[name="baseCat"]:checked').value;
            const isPiso = document.getElementById('isPiso').checked;
            let finalCat = baseCat;
            if (isPiso) finalCat += " piso";

            // Date Logic
            const dStart = document.getElementById('dateStart').value;
            const dEnd = document.getElementById('dateEnd').value;
            const tripType = document.querySelector('input[name="tripType"]:checked').value;
            const isOneWay = tripType === 'oneway';

            if (!dStart) { alert("Please select a travel date."); return; }
            if (tripType === 'roundtrip' && !dEnd) { alert("Please select a return date for Roundtrip."); return; }

            const dateStr = formatDateRange(dStart, dEnd, isOneWay);


            // ID Generation & HTML Construction
            const promoID = "promo-" + Date.now();
            const pisoTag = isPiso ? '<span class="tag-piso">üî• PISO FARE WATCH</span>' : '';
            const tripLabel = tripType === 'multicity' ? '<span style="font-size:0.7em; background:#333; padding:2px 4px; border-radius:3px;">Multi-city</span>' : '';

            // Note: btn-delete-card defaults to hidden via CSS class, but we make it visible below since we are Admin
            const newCardHTML = `
            <!-- ADDDED PROMO: ${originVal[1]} to ${destVal[1]} -->
            <article class="ticket-card" id="${promoID}" data-category="${finalCat}">
                <button class="btn-delete-card" onclick="deletePromo('${promoID}', this)" title="Delete Promo">üóëÔ∏è</button>
                <div class="flight-route">
                    <div class="location"><span class="code">${originVal[0]}</span><span class="city">${originVal[1]}</span></div>
                    <div class="plane-icon">‚úàÔ∏è ${tripLabel}</div>
                    <div class="location"><span class="code">${destVal[0]}</span><span class="city">${destVal[1]}</span></div>
                </div>
                <div class="flight-details">
                    ${pisoTag}
                    <p class="travel-date">üìÖ ${dateStr}</p>
                    <p class="airline">Airline: ${airline} (${cabin})</p>
                    <div class="pricing">
                        <div class="price-label">Promo Fare</div>
                        <div class="price-val">${price}</div>
                    </div>
                </div>
                <button onclick="openBooking('${originVal[1]} to ${destVal[1]}', '${price}')" class="btn-claim">Book This Flight</button>
            </article>`;

            // Visual Feedback
            const btn = document.querySelector('.admin-form .btn-claim');
            const originalText = btn.innerText;
            btn.innerText = "‚è≥ Saving...";
            btn.disabled = true;
            statusBox.style.display = 'block';
            statusBox.style.background = '#e0f2fe';
            statusBox.style.color = '#0284c7';
            statusBox.innerText = "Syncing with GitHub... (Do not close)";

            try {
                // 1. Config Dynamic
                const REPO_FULL = `${username}/${repo}`;
                const PATH = "index.html";
                const API_URL = `https://api.github.com/repos/${REPO_FULL}/contents/${PATH}`;

                // 2. Fetch Current File
                const getRes = await fetch(API_URL, {
                    headers: { 'Authorization': `token ${token}`, 'Accept': 'application/vnd.github.v3+json' }
                });

                if (!getRes.ok) {
                    if (getRes.status === 404) throw new Error("Repo or File not found. Double check your Username and Repo Name.");
                    if (getRes.status === 401) throw new Error("Invalid Secret Key (Token).");
                    throw new Error("GitHub Error: " + getRes.statusText);
                }

                const data = await getRes.json();
                const sha = data.sha;
                const currentContent = new TextDecoder().decode(Uint8Array.from(atob(data.content), c => c.charCodeAt(0)));

                // 3. Inject New Card
                const insertionPoint = '<div class="promo-grid" id="mainPromoGrid">';
                if (!currentContent.includes(insertionPoint)) throw new Error("Critical: File structure unknown. Cannot inject promo.");
                const newContent = currentContent.replace(insertionPoint, insertionPoint + "\n" + newCardHTML);

                // 4. Push Update
                const putRes = await fetch(API_URL, {
                    method: "PUT",
                    headers: { 'Authorization': `token ${token}`, 'Accept': 'application/vnd.github.v3+json' },
                    body: JSON.stringify({
                        message: `Add Promo: ${originVal[1]} to ${destVal[1]}`,
                        content: btoa(String.fromCharCode(...new TextEncoder().encode(newContent))),
                        sha: sha
                    })
                });

                if (!putRes.ok) throw new Error("Failed to commit changes.");

                // SUCCESS
                btn.innerText = originalText;
                btn.disabled = false;
                statusBox.style.background = '#dcfce7';
                statusBox.style.color = '#166534';
                statusBox.innerHTML = `‚úÖ <b>Promo Added!</b><br>Added: ${originVal[1]} ‚ûù ${destVal[1]}`;

                // Client-side Update
                const grid = document.getElementById('mainPromoGrid');
                const tempDiv = document.createElement('div');
                tempDiv.innerHTML = newCardHTML;
                const newCardNode = tempDiv.firstElementChild;
                grid.insertBefore(newCardNode, grid.firstChild);

                // Show delete button
                newCardNode.querySelector('.btn-delete-card').style.display = 'flex';

                // RESET FORM
                resetForm();

                // Clear msg later
                setTimeout(() => {
                    statusBox.style.opacity = '0';
                    setTimeout(() => { statusBox.style.display = 'none'; statusBox.style.opacity = '1'; }, 500);
                }, 5000);

            } catch (err) {
                console.error(err);
                btn.innerText = originalText;
                btn.disabled = false;
                statusBox.style.background = '#fee2e2';
                statusBox.innerText = "Error: " + err.message;
            }
        }

        // --- HELPER: Date Formatting ---
        function formatDateRange(start, end, isOneWay) {
            const opts = { month: 'short', day: 'numeric', year: 'numeric' };
            const d1 = new Date(start);

            if (isOneWay || !end) {
                return d1.toLocaleDateString('en-US', opts);
            } else {
                const d2 = new Date(end);
                const m1 = d1.toLocaleDateString('en-US', { month: 'short', day: 'numeric' });
                const m2 = d2.toLocaleDateString('en-US', opts);
                return `${m1} - ${m2}`;
            }
        }


        function toggleTripType() {
            const isRound = document.querySelector('input[name="tripType"][value="roundtrip"]').checked;
            const dateEnd = document.getElementById('dateEnd');
            const lblReturn = document.getElementById('lblReturn');

            // Sync Hidden Checkbox (for existing logic)
            document.getElementById('isOneWay').checked = !isRound;

            if (isRound) {
                dateEnd.disabled = false;
                dateEnd.style.opacity = "1";
                lblReturn.style.opacity = "1";
            } else {
                dateEnd.disabled = true;
                dateEnd.value = "";
                dateEnd.style.opacity = "0.3";
                lblReturn.style.opacity = "0.3";
            }
        }

        // --- RESTORED FUNCTIONS: Customer Interactions ---

        function filterDeals(filter) {
            // Update Buttons
            document.querySelectorAll('.filter-btn').forEach(btn => {
                btn.classList.remove('active');
                if (btn.innerText.toLowerCase().includes(filter) || (filter === 'all' && btn.innerText.includes('Show All'))) {
                    btn.classList.add('active');
                }
            });

            // Filter Cards
            const cards = document.querySelectorAll('.ticket-card');
            cards.forEach(card => {
                const cats = card.getAttribute('data-category');
                if (filter === 'all' || cats.includes(filter)) {
                    card.style.display = 'flex';
                } else {
                    card.style.display = 'none';
                }
            });
        }

        function openBooking(route, price) {
            document.getElementById('bookingModal').classList.add('show');
            document.getElementById('modalRoute').innerText = route;
            document.getElementById('modalPrice').innerText = price;

            // Fill hidden inputs
            document.getElementById('inputRoute').value = route;
            document.getElementById('inputPrice').value = price;
        }

        function closeModal() {
            document.getElementById('bookingModal').classList.remove('show');
        }

        // --- UTILS: Enter Key for Login ---
        document.getElementById('loginPass').addEventListener('keypress', function (e) {
            if (e.key === 'Enter') {
                attemptLogin();
            }
        });
    </script>
</body>

</html>